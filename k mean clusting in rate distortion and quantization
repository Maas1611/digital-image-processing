import cv2
import numpy as np

# Ask user for image path
img_path = input("Enter image path: ")

# Load image
img = cv2.imread(img_path)
if img is None:
    raise ValueError("Could not load image. Check the path.")

img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)

# K-means quantization function
def quantize(img, K=8):
    Z = img.reshape((-1, 3))
    Z = np.float32(Z)

    criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER,
                10, 1.0)

    ret, label, center = cv2.kmeans(Z, K, None, criteria,
                                    10, cv2.KMEANS_RANDOM_CENTERS)

    center = np.uint8(center)
    quantized = center[label.flatten()]
    quantized = quantized.reshape(img.shape)

    return quantized

# Ask user how many colors
K = int(input("Enter number of colors (K): "))

# Apply quantization
output = quantize(img, K)

# Save result
out_path = "quantized_output.png"
cv2.imwrite(out_path, cv2.cvtColor(output, cv2.COLOR_RGB2BGR))

print(f"Done! Saved quantized image to: {out_path}")
